<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard de Vendas - Tempo Real</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
      background:#FF500a;min-height:100vh;padding:16px;overflow-x:hidden
    }
    .container{max-width:1280px;margin:0 auto}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .logo{color:#fff;font-size:1.8rem;font-weight:800}
    .sync-status{background:#fff;color:#FF500a;padding:8px 14px;border-radius:18px;font-weight:700;display:flex;align-items:center;gap:8px}
    .sync-indicator{width:10px;height:10px;background:#10b981;border-radius:50%}
    .loading-screen{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;color:#fff;text-align:center}
    .dashboard{display:block}

    /* Minimalismo */
    .store-selector{background:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.18);margin-bottom:12px}
    .store-selector select{width:100%;padding:10px 12px;font-size:1rem;border:2px solid #FF500a;border-radius:8px;font-weight:700;background:#fff}

    .metrics-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:12px}
    .metric-card{background:#fff;padding:12px;border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.18)}
    .metric-label{color:#666;font-size:.78rem;margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px;font-weight:800}
    .metric-value{font-size:1.4rem;font-weight:800;color:#FF500a;margin-bottom:4px}
    .metric-trend{display:flex;align-items:center;gap:6px;font-size:.86rem;font-weight:700}
    .trend-up{color:#10b981}.trend-down{color:#ef4444}

    .charts-row{display:grid;grid-template-columns:2fr 1fr;gap:10px;margin-bottom:12px}
    .charts-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:12px}
    .chart-card{background:#fff;padding:12px;border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.18)}
    .chart-title{font-size:1rem;color:#333;margin-bottom:6px;font-weight:800;display:flex;align-items:center;gap:8px}

    .gauge-container{position:relative;height:120px;display:flex;align-items:center;justify-content:center}
    #gaugeChart{height:110px!important}

    .top-stores{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:12px}
    .top-card{background:#fff;padding:12px;border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.18)}
    .top-item{display:flex;justify-content:space-between;align-items:center;padding:8px;margin-bottom:6px;background:#f8f9fa;border-radius:8px}
    .top-item-rank{font-size:1.2rem;font-weight:800;margin-right:10px}
    .top-item-name{flex:1;font-weight:700}
    .top-item-value{font-weight:800;color:#FF500a}

    .stores-table{background:#fff;padding:12px;border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.18);overflow-x:auto}
    table{width:100%;border-collapse:collapse}
    th{background:#FF500a;color:#fff;padding:10px;text-align:left;font-weight:800;font-size:.9rem}
    td{padding:10px;border-bottom:1px solid #eee;font-size:.9rem}
    tr:hover{background:#fff5f3}
    .badge{display:inline-block;padding:3px 10px;border-radius:12px;font-size:.8rem;font-weight:800}
    .badge-success{background:#d1fae5;color:#065f46}
    .badge-danger{background:#fee2e2;color:#991b1b}

    /* Responsivo simplificado */
    @media (max-width: 1100px){
      .metrics-grid{grid-template-columns:repeat(3,1fr)}
      .charts-row{grid-template-columns:1fr}
      .charts-grid{grid-template-columns:1fr}
      .top-stores{grid-template-columns:1fr}
    }
    @media (max-width: 640px){
      .metrics-grid{grid-template-columns:repeat(2,1fr)}
      .logo{font-size:1.4rem}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">üìä Dashboard de Vendas - Tempo Real</div>
      <div class="sync-status">
        <div class="sync-indicator" id="syncDot"></div>
        <span id="syncStatus">Sincronizando...</span>
      </div>
    </div>

    <div class="store-selector">
      <select id="storeSelect" onchange="updateDashboard()">
        <option value="all">üìç Todas as Lojas</option>
      </select>
    </div>

    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-label">Vendas Totais</div>
        <div class="metric-value" id="totalSales">R$ 0</div>
        <div class="metric-trend" id="salesTrend"></div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Vendas Balc√£o</div>
        <div class="metric-value" id="counterSales">R$ 0</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Delivery</div>
        <div class="metric-value" id="deliverySales">R$ 0</div>
        <div class="metric-trend" id="deliveryTrend"></div>
      </div>
      <div class="metric-card">
        <div class="metric-label">% Delivery</div>
        <div class="metric-value" id="deliveryPercent">0%</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Previs√£o M√™s</div>
        <div class="metric-value" id="forecast">R$ 0</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Meta do M√™s</div>
        <div class="metric-value" id="goalValue">R$ 0</div>
        <div class="metric-trend" id="goalStatus"></div>
      </div>
    </div>

    <div class="charts-row">
      <div class="chart-card">
        <div class="chart-title">üìà Evolu√ß√£o de Vendas</div>
        <div style="height:220px">
          <canvas id="salesChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-title">üéØ Progresso da Meta</div>
        <div class="gauge-container">
          <canvas id="gaugeChart"></canvas>
        </div>
      </div>
    </div>

    <div class="top-stores">
      <div class="top-card">
        <div class="chart-title">üèÜ Top 3 Melhores Lojas</div>
        <div id="topStores"></div>
      </div>
      <div class="top-card">
        <div class="chart-title">‚ö†Ô∏è Top 3 Lojas em Alerta</div>
        <div id="bottomStores"></div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-title">üöö Evolu√ß√£o do Delivery</div>
        <div style="height:200px">
          <canvas id="deliveryChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-title">üè™ Vendas por Loja</div>
        <div style="height:220px">
          <canvas id="storesChart"></canvas>
        </div>
      </div>
    </div>

    <div class="stores-table">
      <div class="chart-title">üìã Resumo Detalhado por Loja</div>
      <table id="storesTable">
        <thead>
        <tr>
          <th>Loja</th>
          <th>Vendas Balc√£o</th>
          <th>Delivery</th>
          <th>Total</th>
          <th>% Delivery</th>
          <th>Previs√£o M√™s</th>
          <th>Meta</th>
          <th>Status Meta</th>
          <th>Tend√™ncia</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // ======= CONFIG =======
    // Se voc√™ usar Apps Script, troque para true e preencha SHEET_API_URL.
    const USE_APPS_SCRIPT = true;

    // URL p√∫blica do CSV do Google Sheets (n√£o tem CORS):
    const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQOilCaKcPSn1mh5zp8yd7TrjJpRFqspq-4NZErDtSibx7QqK0PggMQfCYlruJmeU6ebjZGXEqO3L9T/pub?gid=0&single=true&output=csv';

    // Op√ß√£o 1 (recomendada para GitHub Pages): Seu PROXY com CORS liberado
    // Exemplo de rota: https://seu-dominio.com/proxy?url=<ENCODED>
    // Coloque aqui a URL base do seu proxy:
    const PROXY_CORS_URL = 'https://YOUR_PROXY_DOMAIN/proxy?url=';

    // Op√ß√£o 2 (Apps Script Web App retornando JSON com CORS):
    const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbzA5tqE0f7KpJ%E2%80%A6/exec';

    const REFRESH_INTERVAL = 10000; // 10s

    let salesData = [];
    let salesChart, storesChart, deliveryChart, gaugeChart;

    function setSync(message, isError=false){
      document.getElementById('syncStatus').textContent = message;
      document.getElementById('syncDot').style.background = isError ? '#ef4444' : '#10b981';
      document.title = 'Dashboard - ' + message;
    }

    // Carregar dados
    loadDataFromSource();
    setInterval(loadDataFromSource, REFRESH_INTERVAL);

    async function loadDataFromSource() {
      try {
        setSync('Sincronizando...');
        let dataRows;

        if (USE_APPS_SCRIPT) {
          // Apps Script deve responder JSON: [{date:'DD/MM/YYYY', store:'Loja', counter:123, delivery:45, goal:1000}, ...]
          const resp = await fetch(SHEET_API_URL, {mode: 'cors', cache: 'no-store'});
          if (!resp.ok) throw new Error('Erro HTTP ' + resp.status);
          dataRows = await resp.json();
        } else {
          // Via proxy CORS lendo o CSV p√∫blico
          const proxied = PROXY_CORS_URL + encodeURIComponent(SHEET_CSV_URL + '&t=' + Date.now());
          const resp = await fetch(proxied, {mode: 'cors', cache: 'no-store'});
          if (!resp.ok) throw new Error('Erro HTTP ' + resp.status);
          const csvText = await resp.text();
          dataRows = parseCSV(csvText);
        }

        if (!Array.isArray(dataRows) || dataRows.length === 0) throw new Error('Sem dados v√°lidos');

        // Normaliza e ordena
        salesData = dataRows.map(row => ({
          date: parseDate(row.date),
          store: String(row.store || '').trim(),
          counter: toNum(row.counter),
          delivery: toNum(row.delivery),
          goal: toNum(row.goal)
        })).filter(r => r.store && r.date instanceof Date && !isNaN(r.date));

        salesData.sort((a,b)=> a.date - b.date);

        populateStoreSelector();
        updateDashboard();
        setSync('Atualizado agora');
      } catch (e) {
        console.error('Falha ao carregar:', e);
        setSync('Erro na sincroniza√ß√£o', true);
      }
    }

    // Parse CSV b√°sico -> array de objetos
    function parseCSV(csv){
      const lines = csv.split('\n').map(l=>l.replace(/\r/g,'').trim()).filter(Boolean);
      // Esperado: Data,Loja,Balc√£o,Delivery,Meta
      const out = [];
      for (let i=1;i<lines.length;i++){
        const cols = splitCSVLine(lines[i]);
        if (cols.length >= 5){
          out.push({
            date: cols[0],
            store: cols[1],
            counter: cols[2],
            delivery: cols[3],
            goal: cols[4]
          });
        }
      }
      return out;
    }

    // Divide linha CSV respeitando aspas
    function splitCSVLine(line){
      const res=[]; let cur=''; let q=false;
      for (let i=0;i<line.length;i++){
        const c=line[i];
        if (c === '"'){ q=!q; continue; }
        if (c === ',' && !q){ res.push(cur); cur=''; continue; }
        cur += c;
      }
      res.push(cur);
      return res;
    }

    function toNum(v){ const n = parseFloat(String(v).replace(/\./g,'').replace(',','.')); return isNaN(n)?0:n; }

    function parseDate(s){
      if (!s) return new Date();
      const parts = String(s).trim().split('/');
      if (parts.length===3){
        const d = new Date(Number(parts[2]), Number(parts[1])-1, Number(parts[0]));
        if (!isNaN(d)) return d;
      }
      const d = new Date(s);
      return isNaN(d) ? new Date() : d;
    }

    function populateStoreSelector(){
      const stores = [...new Set(salesData.map(d=>d.store))];
      const sel = document.getElementById('storeSelect');
      const current = sel.value;
      sel.innerHTML = '<option value="all">üìç Todas as Lojas</option>' +
        stores.map(s=>`<option value="${s}">üè™ ${s}</option>`).join('');
      if (stores.includes(current)) sel.value = current;
    }

    function updateDashboard(){
      const selected = document.getElementById('storeSelect').value;
      const data = selected==='all' ? salesData : salesData.filter(d=>d.store===selected);
      updateMetrics(data, selected);
      updateSalesChart(data);
      updateDeliveryChart(data);
      if (selected==='all') updateStoresChart();
      updateTable();
      updateTopStores();
    }

    function updateMetrics(data, selectedStore){
      const totalCounter = data.reduce((s,d)=>s+d.counter,0);
      const totalDelivery = data.reduce((s,d)=>s+d.delivery,0);
      const totalSales = totalCounter + totalDelivery;

      const dates = data.map(d=>d.date);
      const minDate = new Date(Math.min(...dates));
      const maxDate = new Date(Math.max(...dates));
      const daysInData = Math.max(1, Math.ceil((maxDate - minDate)/(1000*60*60*24))+1);
      const avgDaily = totalSales / daysInData;
      const daysInMonth = new Date(maxDate.getFullYear(), maxDate.getMonth()+1, 0).getDate();
      const forecast = avgDaily * daysInMonth;

      const goal = selectedStore==='all'
        ? [...new Set(salesData.map(d=>d.store))].reduce((sum, store)=>{
            const g = salesData.find(d=>d.store===store && d.goal>0)?.goal || 0;
            return sum + g;
          },0)
        : (data.find(d=>d.goal>0)?.goal || 0);

      const deliveryPercent = totalSales>0 ? (totalDelivery/totalSales*100) : 0;

      const salesTrend = calcTrend(data.map(d=>({sales:d.counter+d.delivery})));
      const deliveryTrend = calcTrend(data.map(d=>({sales:d.delivery})));

      setText('totalSales', money(totalSales));
      setText('counterSales', money(totalCounter));
      setText('deliverySales', money(totalDelivery));
      setText('deliveryPercent', deliveryPercent.toFixed(1)+'%');
      setText('forecast', money(forecast));
      setText('goalValue', money(goal));

      document.getElementById('salesTrend').innerHTML = salesTrend>=0
        ? `<span class="trend-up">‚ñ≤ ${salesTrend.toFixed(1)}%</span>`
        : `<span class="trend-down">‚ñº ${Math.abs(salesTrend).toFixed(1)}%</span>`;

      document.getElementById('deliveryTrend').innerHTML = deliveryTrend>=0
        ? `<span class="trend-up">‚ñ≤ ${deliveryTrend.toFixed(1)}%</span>`
        : `<span class="trend-down">‚ñº ${Math.abs(deliveryTrend).toFixed(1)}%</span>`;

      document.getElementById('goalStatus').innerHTML = forecast>=goal
        ? `<span class="trend-up">‚úì No caminho</span>`
        : `<span class="trend-down">‚úó Abaixo</span>`;

      updateGaugeChart(forecast, goal);
    }

    function setText(id, txt){ document.getElementById(id).textContent = txt; }

    function calcTrend(arr){
      if (arr.length<2) return 0;
      const mid = Math.floor(arr.length/2);
      const f = arr.slice(0,mid).reduce((s,d)=>s+d.sales,0) / Math.max(1,mid);
      const s = arr.slice(mid).reduce((s2,d)=>s2+d.sales,0) / Math.max(1,arr.length-mid);
      if (f===0) return 0;
      return ((s-f)/f)*100;
    }

    // ===== Charts minimalistas =====
    function updateSalesChart(data){
      const daily = {};
      data.forEach(d=>{
        const k = d.date.toLocaleDateString('pt-BR');
        if (!daily[k]) daily[k] = {counter:0, delivery:0};
        daily[k].counter += d.counter;
        daily[k].delivery += d.delivery;
      });
      const labels = Object.keys(daily);
      const counterValues = labels.map(k=>daily[k].counter);
      const deliveryValues = labels.map(k=>daily[k].delivery);

      if (salesChart) salesChart.destroy();
      const ctx = document.getElementById('salesChart').getContext('2d');
      salesChart = new Chart(ctx, {
        type:'line',
        data:{
          labels,
          datasets:[
            {label:'Balc√£o', data:counterValues, borderColor:'#FF500a', tension:.3, fill:false, borderWidth:2, pointRadius:0},
            {label:'Delivery', data:deliveryValues, borderColor:'#10b981', tension:.3, fill:false, borderWidth:2, pointRadius:0}
          ]
        },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{display:false}, title:{display:false}, tooltip:{mode:'index', intersect:false} },
          elements:{ point:{radius:0} },
          layout:{padding:0},
          scales:{
            x:{ grid:{display:false}, ticks:{ maxTicksLimit:6 }},
            y:{ grid:{display:false}, ticks:{ maxTicksLimit:4, callback:v=>'R$ '+Number(v).toLocaleString('pt-BR') }, beginAtZero:true }
          }
        }
      });
    }

    function updateDeliveryChart(data){
      const daily = {};
      data.forEach(d=>{
        const k = d.date.toLocaleDateString('pt-BR');
        daily[k] = (daily[k]||0) + d.delivery;
      });
      const labels = Object.keys(daily);
      const values = labels.map(k=>daily[k]);

      if (deliveryChart) deliveryChart.destroy();
      const ctx = document.getElementById('deliveryChart').getContext('2d');
      deliveryChart = new Chart(ctx,{
        type:'bar',
        data:{ labels, datasets:[{ data:values, backgroundColor:'#10b981', borderWidth:0, barPercentage:.6, categoryPercentage:.8 }] },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{display:false}, title:{display:false} },
          layout:{padding:0},
          scales:{
            x:{ grid:{display:false}, ticks:{maxTicksLimit:6}},
            y:{ grid:{display:false}, beginAtZero:true,
                ticks:{ maxTicksLimit:4, callback:v=>'R$ '+Number(v).toLocaleString('pt-BR') } }
          }
        }
      });
    }

    function updateStoresChart(){
      const stores = {};
      salesData.forEach(d=>{
        if (!stores[d.store]) stores[d.store] = {counter:0, delivery:0};
        stores[d.store].counter += d.counter;
        stores[d.store].delivery += d.delivery;
      });
      const labels = Object.keys(stores);
      const counterValues = labels.map(s=>stores[s].counter);
      const deliveryValues = labels.map(s=>stores[s].delivery);

      if (storesChart) storesChart.destroy();
      const ctx = document.getElementById('storesChart').getContext('2d');
      storesChart = new Chart(ctx,{
        type:'bar',
        data:{
          labels,
          datasets:[
            {label:'Balc√£o', data:counterValues, backgroundColor:'#FF500a'},
            {label:'Delivery', data:deliveryValues, backgroundColor:'#10b981'}
          ]
        },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{display:true, position:'top'} },
          scales:{
            x:{ stacked:true },
            y:{ stacked:true, beginAtZero:true,
                ticks:{ callback:v=>'R$ '+Number(v).toLocaleString('pt-BR') } }
          }
        }
      });
    }

    function updateGaugeChart(forecast, goal){
      const pct = goal>0 ? Math.min((forecast/goal)*100, 100) : 0;
      if (gaugeChart) gaugeChart.destroy();
      const ctx = document.getElementById('gaugeChart').getContext('2d');
      gaugeChart = new Chart(ctx,{
        type:'doughnut',
        data:{ datasets:[{ data:[pct, 100-pct],
          backgroundColor:[ pct>=100?'#10b981' : pct>=80 ? '#FF500a' : '#ef4444', '#e5e7eb' ],
          borderWidth:0 }] },
        options:{
          responsive:true, maintainAspectRatio:false,
          circumference:180, rotation:270, cutout:'80%',
          plugins:{ legend:{display:false}, tooltip:{enabled:false} },
          layout:{padding:0}
        },
        plugins:[{
          id:'gaugeText',
          afterDraw:(chart)=>{
            const c = chart.ctx, a = chart.chartArea;
            const cx = a.left + (a.right-a.left)/2;
            const cy = a.top + (a.bottom-a.top)/2 + 12;
            c.save();
            c.font = 'bold 22px Arial';
            c.fillStyle = '#333';
            c.textAlign='center'; c.textBaseline='middle';
            c.fillText(pct.toFixed(1)+'%', cx, cy);
            c.font = '12px Arial'; c.fillStyle='#666';
            c.fillText('da meta', cx, cy+18);
            c.restore();
          }
        }]
      });
    }

    function updateTopStores(){
      const stores = [...new Set(salesData.map(d=>d.store))];
      const stats = stores.map(store=>{
        const sd = salesData.filter(d=>d.store===store);
        const total = sd.reduce((s,d)=>s+d.counter+d.delivery,0);
        const dates = sd.map(d=>d.date);
        const minD = new Date(Math.min(...dates)); const maxD = new Date(Math.max(...dates));
        const days = Math.max(1, Math.ceil((maxD-minD)/(1000*60*60*24))+1);
        const avg = total/days; const dim = new Date(maxD.getFullYear(), maxD.getMonth()+1, 0).getDate();
        const forecast = avg*dim;
        return {store,total,forecast};
      }).sort((a,b)=>b.total-a.total);

      document.getElementById('topStores').innerHTML = stats.slice(0,3).map((s,i)=>`
        <div class="top-item">
          <div class="top-item-rank">${['ü•á','ü•à','ü•â'][i]}</div>
          <div class="top-item-name">${s.store}</div>
          <div class="top-item-value">${money(s.total)}</div>
        </div>`).join('');

      document.getElementById('bottomStores').innerHTML = stats.slice(-3).reverse().map((s,i)=>`
        <div class="top-item">
          <div class="top-item-rank">${i+1}</div>
          <div class="top-item-name">${s.store}</div>
          <div class="top-item-value">${money(s.total)}</div>
        </div>`).join('');
    }

    function updateTable(){
      const stores = [...new Set(salesData.map(d=>d.store))];
      const tbody = document.querySelector('#storesTable tbody');
      tbody.innerHTML = '';
      stores.forEach(store=>{
        const sd = salesData.filter(d=>d.store===store);
        const totalCounter = sd.reduce((s,d)=>s+d.counter,0);
        const totalDelivery = sd.reduce((s,d)=>s+d.delivery,0);
        const total = totalCounter+totalDelivery;

        const dates = sd.map(d=>d.date);
        const minD = new Date(Math.min(...dates)); const maxD = new Date(Math.max(...dates));
        const days = Math.max(1, Math.ceil((maxD-minD)/(1000*60*60*24))+1);
        const avg = total/days; const dim = new Date(maxD.getFullYear(), maxD.getMonth()+1, 0).getDate();
        const forecast = avg*dim;
        const goal = sd.find(d=>d.goal>0)?.goal || 0;
        const delPct = total>0 ? (totalDelivery/total*100) : 0;
        const trend = calcTrend(sd.map(d=>({sales:d.counter+d.delivery})));
        const trendIcon = trend>=0 ? 'üìà' : 'üìâ';
        const trendClass = trend>=0 ? 'trend-up' : 'trend-down';
        const goalBadge = forecast>=goal ? '<span class="badge badge-success">‚úì Atingir√°</span>' : '<span class="badge badge-danger">‚úó Abaixo</span>';

        tbody.insertAdjacentHTML('beforeend', `
          <tr>
            <td><strong>${store}</strong></td>
            <td>${money(totalCounter)}</td>
            <td>${money(totalDelivery)}</td>
            <td><strong>${money(total)}</strong></td>
            <td>${delPct.toFixed(1)}%</td>
            <td>${money(forecast)}</td>
            <td>${money(goal)}</td>
            <td>${goalBadge}</td>
            <td class="${trendClass}">${trendIcon} ${trend.toFixed(1)}%</td>
          </tr>
        `);
      });
    }

    function money(v){ return 'R$ ' + Number(v).toLocaleString('pt-BR',{minimumFractionDigits:2, maximumFractionDigits:2}); }
  </script>

  <!--
  Se preferir remover totalmente problemas de CORS sem proxy, use Google Apps Script:

  1) Em https://script.google.com > Novo projeto. Colar:
  function doGet() {
    const id = 'ID_DA_SUA_PLANILHA';
    const sh = SpreadsheetApp.openById(id).getSheets()[0];
    const values = sh.getDataRange().getValues(); // cabe√ßalho + linhas
    const out = [];
    for (let i=1;i<values.length;i++){
      const [date, store, counter, delivery, goal] = values[i];
      out.push({
        date: Utilities.formatDate(new Date(date), Session.getScriptTimeZone(), 'dd/MM/yyyy'),
        store: String(store||''),
        counter: Number(counter||0),
        delivery: Number(delivery||0),
        goal: Number(goal||0)
      });
    }
    const resp = ContentService.createTextOutput(JSON.stringify(out)).setMimeType(ContentService.MimeType.JSON);
    // CORS
    resp.setHeader('Access-Control-Allow-Origin','*');
    return resp;
  }
  2) Deploy > Implementar como aplicativo da Web > Acesso: Qualquer pessoa com o link.
  3) Copie a URL do deploy e use em SHEET_API_URL; defina USE_APPS_SCRIPT = true.
  -->
</body>
</html>
